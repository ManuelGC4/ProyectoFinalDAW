{% extends 'blog/blogBase.html.twig' %}

{% block titulo %}
	{{video.titulo}}
	-
	{{ parent() }}
{% endblock %}

{% block main %}
	<div id="main" class="col-9">
		<p class="small">
			<a href="{{ path('index') }}">←
				{% trans %}video.volver{% endtrans %}</a>
		</p>
		<h2>{{video.titulo}}</h2>
		<p class="small">
			{% trans %}video.publicado{% endtrans %}
			{% if video.usuario is null %}
				{% trans %}video.desconocido{% endtrans %}
			{% else %}
				{{video.usuario.nick}}
			{% endif %}

			{% trans %}video.en{% endtrans %}
			{{video.fecha|date("Y-m-d H:i:s")}}
		</p>
		<div id="vidcover"><video src="{{ asset('videos/video-' ~ video.id ~ '.mp4') }}" width="100%" height="auto" controls/></div>

		{% if is_granted('ROLE_ADMIN') %}
			<p>
				<a href="{{ path('editarVideo', {'id' : video.id}) }}">{% trans %}video.editar{% endtrans %}</a>
			</p>
			<p>
				<a href="{{ path('borrarVideo', {'id' : video.id}) }}">{% trans %}video.borrar{% endtrans %}</a>
			</p>
		{% endif %}

		<h2>{% trans %}video.comentario{% endtrans %}</h2>
		<ul>
			{% for comentario in video.comentarios %}
				<li class='bloqueComentario'>
					<p class="{% if video.usuario == comentario.usuario %}usuario{% endif %}">
						<strong>
							<a href="mailto:{{ comentario.usuario.email }}">{{ comentario.usuario.nick }}</a>
						</strong>
						{% trans %}video.en{% endtrans %}
						{{ comentario.fecha|date("Y-m-d H:i:s") }}:</p>
					<p>{{ comentario.texto|raw }}</p>
				</li>
			{% else %}
				<li>{% trans %}video.comentarioMensaje{% endtrans %}</li>
			{% endfor %}
		</ul>
		{% if is_granted('ROLE_USER') %}
			{{ form_start(form) }}<p>{{ form_label(form.texto) }}<br/>{{ form_widget(form.texto) }}<br/>{{ form_help(form.texto) }}</p>
			<div class="form-error">{{ form_errors(form.texto) }}</div>
			{{form_row(form.save) }}{{ form_end(form) }}
		{% else %}
			<div align="center">
				<p>
					Debes iniciar sesión para comentar.
					<a href="{{ path("app_login") }}">Iniciar sesión</a>
				</p>
			</div>
		{% endif %}
	</div>
{% endblock %}

{% block derecha %}
	<div id="lateral" class="col-3"></div>
{% endblock %}

{% block javascripts %}
	{{ parent() }}<script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
	<script>
		tinymce.init({selector: 'textarea'});
	</script>
{% endblock %}
